---
import Logout from '../components/Logout.astro';
import FormLayout from '../layouts/FormLayout.astro';
import { fetchFromApi } from '../lib/api/api';


const token = Astro.cookies.get('token')?.value;

let user = null;
let message = '';

if (token) {
  try {
    const result = await fetchFromApi('api/login', {
      headers: {
        Authorization: `Bearer ${token}`,
         Accept: 'application/json'
      }
    });
    
    user = result.user;
    message = result.message;


  } catch (err) {
    console.error('Error al autenticar:', err);
    message = 'SESION NO INICIADA.';
  }
}
---
<FormLayout>

  
  <div class="max-w-3xl mx-auto px-4">
    <div class="max-w-7xl mx-auto mb-8">
         <div class="w-full h-auto rounded-t-xl bg-white border-b-1 border-b-gray-300 px-6 py-6 mt-12">

           <h1 class="flex flex-row items-center text-xl text-purple-500 gap-2">
               <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lightbulb-icon lucide-lightbulb"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>
               Tu perfil
           </h1>

       </div>
       <div class="w-full max-w-3xl mx-auto bg-white rounded-b-2xl p-8 shadow-2xl transition-all duration-300">
        {user ? (
          <>
            <h2 class="text-2xl font-semibold text-gray-800 mb-2">Bienvenido, <span class="text-purple-600">{user.name}</span></h2>
            <p class="text-gray-600 mb-1"><span class="font-medium text-gray-700">Email:</span> {user.email}</p>
            <p class="text-gray-700">{message}</p>
          </>
        ) : (
          <p class="text-xl text-purple-600 font-semibold text-center">{message || 'Usuario no autenticado'}</p>
        )}
      <Logout />
    
      </div>

   </div>
</FormLayout>
